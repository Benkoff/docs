# Gamification

Геймификация призвана акцентировать внимание участников на правильных моментах принятых в juja сообществе, таких как: помогать друг другу, ходить по собеседования, постить публикации, становиться Хранителями, постить дейли рипортики и так далее - при этом за ту или иную активность предусмотрено вручение джуджиков (сам себе или кто-то тебе).

Микросервис является базой сохраненных джуджиков, предсотавляет API в соответствии с бизнес правилами геймификации, описанным [тут](http://bit.ly/juja-427851AB)


**[ссылка на старый документ до переноса](https://docs.google.com/document/d/10cDJqLKCvGDVadfM6xPk2SrblkrED587ThdB7O406PU/edit)**


## Технические характеристики проекта:

* JDK8
* Mongo
* SpringBoot
* SpringData
* SpringMVC
* jUnit
* FakeMongo 
* LordOfTheJars

В качетстве View будет использоваться SPA UI c помощью angular и SlackBot который будет дергать за те или иные endpoint в ответ на те или иные сообщения участников.


## Общие положения:

* **GMF-D1** При работе сервиса ничего никогда не удаляется - всегда происходит update или insert. Если необходимо скрыть ту или иную запись - вставляется флаг hidden=true
* **GMF-D2** UID или user id - идентификатор пользователя, взятый из базы данных пользователей CRM сервиса (а не контакт, который может меняться со временем). 
* **GMF-D3** Ачивка Каждый факт передачи джуджиков за то или иное положительное действие называется Achievement (ачивка) - это одна транзакция от юзера к юзеру за то или иное действие. 
* **GMF-D3-1** Ачивка состоит из текстового описания
* **GMF-D3-2** Ачивка состоит из даты, когда была выдана
* **GMF-D3-4** Ачивка состоит из UID (user id) от кого
* **GMF-D3-5** Ачивка состоит из UID кому
* **GMF-D3-6** Ачивка состоит из количества джуджиков (points) (для разных активностей это число различное: дейлик = 1, хранитель = 2, interview = 10, codenjoy = 1, 3 or 5). Таким образом мы сигнализуем, что разные активности по разному полезны для учащегося.
* **GMF-D4** Для начала нет никакой авторизации. Каждый участник может вызывать все методы сервиса, указывая при этом в каждом запросе, от чьего имени исходит запрос и дополнительные детали, связанные с этой фичей. В будущем (возможно) планируется авторизация пользователя и, вероятно, это будет перенесено на плечи view (SlackBot).
* **GMF-D5-1** Каждый метод в ответ возвращает JSON с данными о создаваемом или модицифируемом объекте. 
* **GMF-D5-2** В случае ошибки на выход возвращается json в формате {“errorCode”:”N”, “message”:”сообщение”}, где errorCode код описания еррор-фичи в этой доке, например “GMF-F5-D4”.
* **GMF-D6** В случае успешно выполненной операции для void методов юзер получает ответ 200 OK. “void метод” - это endpoint который не подразумевает возврата результата. Смотри детальнее [тут](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP#200)


## Список фичей

### GMF-F1

**GMF-F1 Я как пользователь хочу иметь возможность просмотреть список всех участников с информацией о сумме набранных ими джуджиков за весь период.**

* GMF-F1-D1 В качестве UID будет выступать идентификатор пользователя, взятый из базы данных пользователей CRM сервиса (а не контакт, который может меняться со временем). Детальнее смотри GMF-D2
* GMF-F1-D2 Джуджики суммируются за весь период от самого первого выданного пользователю, до сегодняшнего дня
* GMF-F1-URL

    ```
    url - "/user/pointSum"
    method - GET
    ```

* GMF-F1-REQ

* GMF-F1-RSP

    ```
    [
        { “to” : “...”,
            “point” : ...},
        { “to” : “...”,
            “point” : ...},
    ]
    ```

### GMF-F2

**GMF-F2 Я как пользователь хочу иметь возможность посмотреть всю активность заданных в списке пользователей с тем, чтобы понять динамику их участия в проекте.**

* GMF-F2-D1 Список должен состоять из юзеров, каждый из который имеет подсписок джуджиков (не группированный по дням как на рисунке - это задача view).
* GMF-F2-D2 Каждый факт передачи джуджика за то или иное положительное действие называется Achievement (ачивка). Детальнее про ачивки смотри GMF-D3
* GMF-F2-URL

    ```
    url - "/user/achieveDetails"
    method - POST
    ```

* GMF-F2-REQ

    ```sh
    {
    “toIds”: [ “..”, “...”]
    }
    ```

* GMF-F2-RSP

    ``` 
    [
        { “user”: “...”,
        “details”: [ { “id”: “...”,
    “from”: “...”,
    “to”: “...”,
    “sendDate”: ...,
    “point”: ...., 
    “description”: “...”,
    “type”: “...” }...]
    },
        { “user”: “...”,
        “details”: [{}...] }
    ]
    ```

### GMF-F3

**GMF-F3 Я как пользователь хочу иметь возможность посмотреть активность пользователя TODO не помню точно формулировки, команда помогите.**

### GMF-F4

**GMF-F4 Я как пользователь хочу иметь возможность отправить себе daily report с тем, чтобы http://bit.ly/juja-ABD4536 - эта ачивка называется у нас “дейлик”.**

* GMF-F4-D1 Нет необходимости указывать кому - рипорт я могу отправить только сам себе
* GMF-F4-D2 За каждый рипорт я получаю по 1 джуджику в день
* GMF-F4-D3 Если я отправил более одного рипорта за сегодня, то description предыдущего рипорта обновляется - к нему в конец добавляется описание из текущего. 
* GMF-F4-URL

    ```
    url - "/achieve/daily"
    method - POST
    ```

* GMF-F4-REQ

    ```
    { 
        “from” : “...”,
        “description” : “...”
    }
    ```

* GMF-F4-RSP

    ```
    [ “...” ] - один элемент в массиве (id сохраненной ачивки)
    ```

* GMF-F4-S1-REQ ``/daily My daily report message. Bla blab lab alb ababla. ``
* GMF-F4-S2-RSP Спасибо ваш дейлик принят
* GMF-F4-S3-RSP    Текст ошибки. Формат команды “текст из GMF-F4-S1-REQ”

### GMF-F5

**GMF-F5 Я как пользователь хочу иметь возможность поблагодарить участника за помощь, чтобы подчеркнуть значимость взаимопомощи в сообществе - эта ачивка у нас называется “спасибкой”.**

* GMF-F5-D1 Благодарность адресована конкретному пользователю 
* GMF-F5-D2 Одному уникальному получателю - только 1 “спасибка” в день, если это правило нарушается, пользователь должен получить сообщение об ошибке в формате GMF-D5-2 с текстом “Этому пользователю ты уже отправлял спасибку”.

* GMF-F5-D3 За каждый факт благодарности я передаю пользователю, которого благодарю 1 джуджик (point)
* GMF-F5-D4 Если я отправил сегодня 2 “спасибки” мне автоматически отправляется 1 джуджик за то, что я активно участвую в комьюнити с указанием в дескрипшене сообщения “Раздал все спасибки: UID1, UID2”
* GMF-F5-D5 В день я могу отправить не более 2х спасибок, если все же попытаюсь, то получу json сообщение об ошибке в формате GMF-D5-2 с текстом “ты можешь отправить не более 2х спасибо в день”. 
* GMF-F5-D6 Я не могу выставить сам себе спасибку, если я попробую это сделать то получу сообщение об ошибке в формате GMF-D5-2 с текстом “Ты сам себя поблагодарить не можешь. Попробуй составь [дейли-рипортик](http://bit.ly/juja-ABD4536)”
* GMF-F5-URL

    ```
    url - "/achieve/thanks"
    method - POST
    ```

* GMF-F4-REQ

    ```
    { 
        “from” : “...”,
        “to”     : “...”,
        “description” : “...”
    }
    ```

* GMF-F5-RSP

    ```
    [ “...” ]
    ```

   один элемент в массиве (id сохраненной спасибки) в случае, если была отправлена первая за день спасибка от одного пользователя.

    ```
    [
        “...”,
        “...”
    ]
    ```

   два элемента в массиве (айдишки сохраненных спасибок) в случае, если была отправлена вторая за день спасибка (первая айдишка) от одного пользователя, вторая айдишка - присвоенный автоматически джуджик отправителю.

* GMF-F5-S1-REQ  ``/thanks Thanks to @slack_nick_name for bla bla blabl abl. Blabla bla blabl.``
* GMF-F5-S2-RSP Спасибо ваша спасибка для @slack_nick_name принята
* GMF-F5-S3-RSP Текст ошибки. Формат команды “текст из GMF-F4-S1-REQ”. В тексте сообщения должен быть указан ник кому (в любом его месте один раз). нельзя отправлять сразу двоим ребятам - для этого используйте отдельные вызовы команды.



### GMF-F6

**GMF-F6 Я как пользователь хочу иметь возможность отметить победителей codenjoy турнира с тем, чтобы обратить внимание других участников, что у кодинг не только боль, но и fun  - эта ачивка у нас называется “коденжойчик”.**

* GMF-F6-D1 Указываются тройка лидеров: первое, второе и третье место в заданном порядке
* GMF-F6-D2 За первое место пользователь получает 5 джуджиков и автоматическое сообщение “За первое место в турнире Codenjoy”
* GMF-F6-D3 За второе место пользователь получает 3 джуджика и автоматическое сообщение “За второе место в турнире Codenjoy”
* GMF-F6-D4 За третье место пользователь получает 1 джуджик и автоматическое сообщение “За третье место в турнире Codenjoy”
* GMF-F6-D5 За день возможен только 1 турнир, в случае если была попытка выполнить запрос дважды в день, возникает ошибка формате GMF-D5-2 с текстом “За сегодняшний турнир уже были выставлены ачивки”.
* GMF-F6-URL
    ```
    url - "/achieve/codenjoy"
    method - POST
    ```
* GMF-F6-REQ
    ```
    { 
        “from” : “...”,
        “firstPlace” : “...”,
        “secondPlace” : “...”,
        “thirdPlace” : “...”
    }
    ```
* GMF-F6-RSP
    ```
    [
        “...”,
        “...”,
        “...”
    ]
    ```
* GMF-F6-S1-REQ ``/codenjoy -1th @slack_nick_name -2th @slack_nick_name2 -3th @slack_nick_name3``
* GMF-F6-S2-RSP Спасибо мы поблагодарили всех участников: @slack_nick_name, @slack_nick_name2, @slack_nick_name3
* GMF-F6-S3-RSP Текст ошибки. Формат команды “текст из GMF-F6-S1-REQ”. В тексте сообщения призовые места указываются через параметры (как в bash) -1th -2th -3th с указанием слак ников победителей. Только три призовых места допустимо.

### GMF-F7

**GMF-F7 Я как Система хочу иметь возможность выдать Пользователю ачивку за Хранительство, с тем, чтобы отметить важность его вклада в комьюнити.**

* GMF-F7-D1 Текст сообщения к ачивке берется из поля description в запросе.
* GMF-F7-D2 Пользователю выдается 2 поинта за каждое активное направление Хранительствования.
* GMF-F7-D4 Операцию могут выполнять не все пользователи. _В будущем эту оперцию смогут делать только Адиминистратор или Система_
* GMF-F7-D5 За неделю возможна только одна транзакция, в случае если была попытка выполнить запрос дважды в неделю, возникает ошибка формате GMF-D5-2 с текстом “На этой неделе уже благодарили Хранителей”.
* GMF-F7-URL
    ```
    url - "/achieve/keepers/thanks"
    method - POST
    ```
* GMF-F7-REQ
    ```
    { 
        “from” : “...”,
        “to”   : “...”,
        “description” : “...”
    }
    ```
* GMF-F7-RSP
    ```
    [
        “...”,Массив айдишек созданных эчивментов.
        “...”
    ]
    ```

### GMF-F8

***GMF-F8 Я как пользователь хочу иметь возможность получить +6 джуджиков за работу в связке. Связка это команда из четырех участников, к которым можно обратиться за помощью, а также она помогает не "отвалится" от своей первоначальной цели. Формирование команды происходит рандомно. 
В конце недели, в субботу, команда должна принять самостоятельное честное решение, соблюдала ли она условия связки и выставить себе +6 джуджиков.***
* [дока по связкам](https://docs.google.com/document/d/190xabylJ7VW00jbxe5CHI_mns9QrGXL_2KHJeJzO6Mo/edit)

* GMF-F8-D1 ачивка отправляется одним участником связки за всех.
* GMF-F8-D2 за каждую ачивку все участники связки получают +6 джуджиков
* GMF-F8-D3 эту ачивку можно отправить только один раз в неделю.
* GMF-F8-D4 пользователь отправляет только id комманды.
* GMF-F8-D5 необходимо проверять чтобы пользователь отправивший ачивку является участником связки с заданным id.

* GMF-F8-URL
    ```
    url - "/achieve/team/{id}"
    method - POST
    ```
* GMF-F8-REQ
    ```
    { 
        “from” : “...”
    }
    ```
* GMF-F8-RSP ["..."] - массив с id сохраненных ачивок.
* GMF-F8-S1-REQ ``/team {teamId}``
* GMF-F8-S2-RSP Спасибо, ваша работа в команде учтена.
* GMF-F8-S3-RSP Текст ошибки.

### GMF-F9

***GMF-F9 Я как хранитель хочу иметь возможность создавать связки. 
Связка это команда состоящая из четырех человек, которая за свою работу может получить +6 джуджиков раз в неделю.
подробней о связках в GMF-10.***

* <del>GMF-F10-D1 Операцию могут выполнять не все пользователи. Только хранители.</del> (в этой версии не проверяем)
* GMF-F9-D2 Хранитель в комманде указывает четырех пользователей, будущих участников связки.
* GMF-F9-D3 Необходимо проверять чтобы пользователь не состоял уже в другой связке.
* GMF-F9-D4 Номер для связки определяется инкрементом для наибольшего существующего номера связки в БД.

* GMF-F9-URL
```
    url - "/team"
    method - POST
```
* GMF-F9-REQ
```
    {
        "from" : "...",
        "user1" : "...",
        "user2" : "...",
        "user3" : "...",
        "user4" : "..."
    }
```
* GMF-F9-RSP["..."] - один элемент в массиве(id - номер сформированой комманды)
* GMF-F9-S1-REQ /create-team @slack1 @slack2 @slack3 @slack4
* GMF-F9-S2-RSP команда с {teamId} создана.
* GMF-F9-S3-RSP текст ошибки.

### GMF-F10
***GMF-F10 Я как хранитель хочу иметь возможность расформировывать(удалять) связки. 
подробней о связках в GMF-10.***

* <del>GMF-F10-D1 Операцию могут выполнять не все пользователи. Только хранители GMF-D6-3.</del> (в этой версии не проверяем)
* GMF-F10-D2 Хранитель указывает id связки которую необходимо расформировать.

* GMF-F10-URL
```
    url - "/team"
    method - DELETE
```
* GMF-F10-REQ
```
    {
        "from" : "...",
        "teamId" : "..."
    }
```
* GMF-F10-RSP["..."] - GMF-D6
* GMF-F10-S1-REQ /delete-team {teamId}
* GMF-F10-S2-RSP команда с {teamId} расформирована.
* GMF-F10-S3-RSP текст ошибки.

### GMF-F11
***GMF-F11 Я как хранитель хочу иметь возможность получить список всех связок с id и участниками. 
подробней о связках в GMF-10.***

* GMF-F11-D1 Операцию может выполнить любой пользователь.
* GMF-F11-D2 Результатом выполнения этой комманды должен быть список содержащий в себе все активные связки с id и участниками.

* GMF-F11-URL
```
    url - "/teamlist"
    method - GET
```
* GMF-F11-REQ
```
   {}
```
* GMF-F11-RSP["..."] - список связок с id и участниками, отсортированный по id связок.
* GMF-F11-S1-REQ /team-list
* GMF-F11-S2-RSP список связок с id и участниками.
* GMF-F11-S3-RSP текст ошибки.

### GMF-F12

***GMF-F12 Я как пользователь хочу иметь возможность поприветствовать нового участника.***

* GMF-F12-D1 Приветствие отправляется новому пользователю только один раз. 
* GMF-F12-D2 Выдается 1 джуджик
* GMF-F12-D3 Текст (description) приветственного сообщения "Welcome to JuJa!"

* GMF-F12-URL
```
    url - "/achieve/welcome"
    method - POST
```
* GMF-F12-REQ
```
    { 
        “from” : “...”,
        “to” : “...”
    }
```
* GMF-F12-RSP
```
    [ “...” ] - один элемент в массиве (id сохраненной ачивки)
```

### GMF-F13

**GMF-F13 Я как пользователь хочу иметь возможность сделать interview report с целью делиться опытом прохождения собеседований.**

* GMF-F13-D1 Нет необходимости указывать кому - интервью рипорт я могу отправить только сам себе
* GMF-F13-D2 За каждый интервью рипорт я получаю по 10 джуджиков
* GMF-F13-D3 Допускается отправка нескольких интервью рипортов в день. 

* GMF-F13-URL
    ```
    url - "/achieve/interview"
    method - POST
    ```

* GMF-F13-REQ
    ```
    { 
        “from” : “...”,
        “description” : “...”
    }
    ```

* GMF-F13-RSP
    ```
    [ “...” ] - один элемент в массиве (id сохраненной ачивки)
    ```

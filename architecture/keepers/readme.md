# Keepers

Микросервис занимается обработкой информации о Хранителях, специальном типе пользователей курса. 

Данные хранятся в базе MongoDB. Микросервис предоставляет пользователям (другим сервисам) RESTful API


## Технические характеристики:

* JDK8
* Mongo
* SpringBoot
* SpringData
* jUnit
* FakeMongo 

## Общие положения

* **KPR-D1** Хранитель - особенный тип пользователей, которые занимаются активной поддержкой и развитием определенных направлений на курсе.
* **KPR-D2** Хранителем, в контексте данного микросервиса, считается не конкретный пользователь, а заявка (запись в базе данных), которая связывает UID пользователя с описанием направления Хранительствования, за которое он отвечает.
* **KPR-D3** Первый пользователь в системе является Хранителем. Заявка при этом добавляется вручную.
* **KPR-D4** Этот тип пользователей (Хранители) могут совершать определенные дополнительные действия. 
* **KPR-D5** Эту конкретную операцию может совершать только ограниченный набор людей, уже отмеченных как активные Хранители. В случае, если в поле “from” указан не такой пользователь - возникает ошибка формате KPR-D11 с текстом “Только Хранитель может назначить другого Хранителя”.
* **KPR-D6** Эту конкретную операцию может выполнять только Система.
* **KPR-D7** Изначально Хранитель помечается активным.
* **KPR-D8** Хранитель может стать со временем не активным - это значит, что он сейчас имеет права простого пользователя, но это не значит, что информация о его заявке будет удалена из системы - просто в заявке делается пометка об окончании срока его хранительствования.
* **KPR-D9** Один пользователь может быть связан с несколькими направлениями Хранительствования, для каждого такого направления делается отдельная заявка. 
* **KPR-D10** В случае успешно выполненной операции для void методов юзер получает ответ 200 OK. “void метод” - это endpoint который не подразумевает возврата результата. Смотри детальнее [тут](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP#200).
* **KPR-D11** В случае ошибки на выход возвращается json в формате {“errorCode”:”N”, “message”:”сообщение”}, где errorCode код описания еррор-фичи в этой доке, например “KPR-F1-D4”.

## Список фичей

**KPR-F1 Я, как Хранитель, хочу добавить в систему нового Хранителя и сделать его активным**

* KPR-F1-D1 Указывается UID Хранителя, который запоминается в системе.
* KPR-F1-D2 Указывается направление Хранительствования, который запоминается в системе. 
* KPR-F1-D3 В системе сохраняется дата выполнения запроса - с тем, чтобы отметить начало его пути.
* KPR-F1-D4 Операцию могут выполнять не все пользователи. Смотри KPR-D5.

* KPR-F1-URL
  ```
      url - "/keepers"
      method - POST
  ```
* KPR-F1-REQ
   ```
      {
          “from” : “...”,
          “keeper” : “...”,
          “direction” : “...”
      }
   ```
* KPR-F1-RSP
    ```
        [ “...” ] - один элемент в массиве (id сохраненной заявки)
    ```

**KPR-F2 Я, как Хранитель, хочу сделать существующего Хранителя неактивным**

* KPR-F2-D1 Указывается UID Хранителя, которого нужно сделать неактивным.
* KPR-F2-D2 Так как один и тот же пользователь может быть Хранителем в разных направлениях, то при выполнении этого запроса необходимо указать не только UID пользователя, но и направление Хранительствования. Делается это через поле “direction”.
* KPR-F2-D3 В системе сохраняется дата выполнения заявки - с тем, чтобы отметить окончание Хранительствования.
* KPR-F2-D4 Операцию могут выполнять не все пользователи. Смотри KPR-D5.

* KPR-F2-URL
  ```
      url - "/keepers"
      method - PUT
  ```
* KPR-F2-REQ
   ```
      {
          “from” : “...”,
          “keeper” : “...”,
          “direction” : “...”
      }
   ```
   
* KPR-F1-RSP
    ```
        [ “...” ] - один элемент в массиве (id сохраненной заявки)
    ```
    

**KPR-F3 Я, как Хранитель, хочу получить список всех направлений, которые закреплены за активным Хранителем**

* KPR-F3-D1 Указывается UID Хранителя, по которому нужно получить список направлений.
* KPR-F3-D2 Ответом на этот запрос будет список полей direction закрепленных за пользователем, при этом данное направление должно быть активным.
* KPR-F3-D3 В случае отсутствия активных направлений возвращается пустой список.
* KPR-F3-D4 Активный Хранитель, значит тот, который был добавлен ранее через KPR-F1 и не деактивирован по прошествии определенного времени через KPR-F2.
* KPR-F3-D5 Операцию могут выполнять не все пользователи. Смотри KPR-D5.

* KPR-F3-URL
    ```
    url - "/keepers/{uuid}"
    method - GET
    ```

* KPR-F3-REQ
   ```
   {}
   ```

* KPR-F3-RSP 
    ```
    [ 
      “...”,
      “...”
    ]
    ```
    
**KPR-F4 Я, как Система, хочу получить список всех активных Хранителей**

* KPR-F4-D1 Ответом на этот запрос будет массив объектов [{}, {}, {}], где каждый объект - это {"uuid": ["dir1", "dir2", "dir3"] }
* KPR-F4-D2 В случае отсутствия активных Хранителей возвращается пустой массив.
* KPR-F4-D3 Активный Хранитель, значит тот, который был добавлен ранее через KPR-F1 и не деактивирован по прошествии определенного времени через KPR-F2.
* KPR-F4-D4 Операцию могут выполнять не все пользователи. Смотри KPR-D6.

* KPR-F4-URL
    ```
    url - "/keepers"
    method - GET
    ```

* KPR-F4-REQ
   ```
   {}
   ```
* KPR-F4-RSP 
    ```
    [
      { "uuid": ... ,
        "directions": ["dir1", "dir2"]
      },
      { "uuid": ... ,
        "directions": ["dir1", "dir2"]
      }
    ]
    ```